---
# VPC Component Catalog
# Standardized Virtual Private Cloud configuration with environment-specific variations

metadata:
  name: "vpc"
  description: "Virtual Private Cloud with subnets, route tables, and gateways"
  version: "1.0.0"
  category: "foundation"
  service_level: "foundation"

# Environment-specific configurations
configurations:
  production:
    vars:
      # Production VPC settings
      enable_nat_gateway: true
      single_nat_gateway: false        # Multi-AZ NAT for HA
      enable_vpn_gateway: false
      enable_dns_hostnames: true
      enable_dns_support: true

      # Subnet configuration
      create_database_subnets: true
      create_elasticache_subnets: true
      create_redshift_subnets: false

      # Network ACLs
      manage_default_network_acl: true
      default_network_acl_ingress: []
      default_network_acl_egress:
        - rule_no: 100
          protocol: "-1"
          rule_action: "allow"
          cidr_block: "0.0.0.0/0"

      # Flow logs
      enable_flow_log: true
      flow_log_destination_type: "cloud-watch-logs"

    tags:
      HighAvailability: "true"
      DisasterRecovery: "true"
      NetworkSegmentation: "enabled"

  staging:
    vars:
      # Staging VPC settings (similar to production)
      enable_nat_gateway: true
      single_nat_gateway: false
      enable_vpn_gateway: false
      enable_dns_hostnames: true
      enable_dns_support: true

      # Subnet configuration
      create_database_subnets: true
      create_elasticache_subnets: true
      create_redshift_subnets: false

      # Network ACLs
      manage_default_network_acl: true

      # Flow logs (enabled for staging validation)
      enable_flow_log: true
      flow_log_destination_type: "cloud-watch-logs"

    tags:
      HighAvailability: "true"
      NetworkSegmentation: "enabled"

  development:
    vars:
      # Development VPC settings (cost-optimized)
      enable_nat_gateway: true
      single_nat_gateway: true         # Single NAT for cost savings
      enable_vpn_gateway: false
      enable_dns_hostnames: true
      enable_dns_support: true

      # Subnet configuration (minimal)
      create_database_subnets: true
      create_elasticache_subnets: false  # Not needed in dev
      create_redshift_subnets: false

      # Network ACLs (simplified)
      manage_default_network_acl: false

      # Flow logs (disabled for cost savings)
      enable_flow_log: false

    tags:
      CostOptimized: "true"
      NetworkSegmentation: "basic"

  testenv-01:
    vars:
      # Test environment settings (production-like for testing)
      enable_nat_gateway: true
      single_nat_gateway: false       # Multi-AZ for realistic testing
      enable_vpn_gateway: false
      enable_dns_hostnames: true
      enable_dns_support: true

      # Subnet configuration
      create_database_subnets: true
      create_elasticache_subnets: true
      create_redshift_subnets: false

      # Network ACLs
      manage_default_network_acl: true

      # Flow logs (enabled for testing)
      enable_flow_log: true
      flow_log_destination_type: "cloud-watch-logs"

    tags:
      TestEnvironment: "true"
      ProductionParity: "true"

# Common variables across all environments
vars:
  # VPC naming
  name: "${local.name_prefix}"

  # DNS settings
  enable_dns_hostnames: true
  enable_dns_support: true

  # Default security group
  manage_default_security_group: true
  default_security_group_name: "${local.name_prefix}-default"
  default_security_group_ingress: []
  default_security_group_egress:
    - from_port: 0
      to_port: 0
      protocol: "-1"
      cidr_blocks: ["0.0.0.0/0"]

  # Route table settings
  manage_default_route_table: true
  default_route_table_name: "${local.name_prefix}-default"

  # Internet Gateway
  create_igw: true

  # DHCP Options
  enable_dhcp_options: false

  # IPv6 support
  enable_ipv6: false

  # Map public IP on launch
  map_public_ip_on_launch: false

# Component outputs
outputs:
  vpc_id:
    description: "ID of the VPC"
    sensitive: false

  vpc_arn:
    description: "ARN of the VPC"
    sensitive: false

  vpc_cidr_block:
    description: "CIDR block of the VPC"
    sensitive: false

  private_subnets:
    description: "List of IDs of private subnets"
    sensitive: false

  public_subnets:
    description: "List of IDs of public subnets"
    sensitive: false

  database_subnets:
    description: "List of IDs of database subnets"
    sensitive: false

  elasticache_subnets:
    description: "List of IDs of ElastiCache subnets"
    sensitive: false

  nat_gateway_ids:
    description: "List of IDs of the NAT Gateways"
    sensitive: false

  igw_id:
    description: "ID of the Internet Gateway"
    sensitive: false

  vpc_main_route_table_id:
    description: "ID of the main route table associated with this VPC"
    sensitive: false

# Default tags applied to all VPC resources
tags:
  ComponentType: "Networking"
  ServiceLevel: "Foundation"
  ManagedBy: "Terraform"
  Component: "vpc"