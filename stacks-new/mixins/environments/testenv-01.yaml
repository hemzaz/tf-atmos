---
# Test Environment 01 configuration mixin
# Dedicated testing environment for integration and performance testing

vars:
  # Environment identification
  environment: "testenv-01"
  environment_type: "testing"
  environment_purpose: "Integration and performance testing"

  # Testing-specific settings
  testing_config:
    # Test automation settings
    automated_testing: true
    performance_testing: true
    load_testing: true
    integration_testing: true

    # Test data management
    test_data_retention_days: 30
    test_data_refresh_schedule: "weekly"
    synthetic_data_enabled: true

    # Test environment isolation
    network_isolation: true
    data_isolation: true

  # Availability settings (balanced for testing)
  high_availability:
    enabled: true
    multi_az: true                # Multi-AZ for realistic testing
    cross_region_backup: false    # No cross-region for test env
    auto_scaling_enabled: true
    load_balancer_enabled: true

  # Security configuration (production-like for testing)
  security:
    # Production-like security for realistic testing
    enable_waf: true
    encryption_at_rest: true
    encryption_in_transit: true
    require_mfa: false            # No MFA required for test access
    session_timeout: 14400        # 4 hours for test sessions

    # Logging and monitoring (enhanced for testing)
    cloudtrail_enabled: true
    vpc_flow_logs: true
    config_service_enabled: true
    guardduty_enabled: false      # Disabled to reduce noise
    security_hub_enabled: false   # Disabled to reduce noise

    # Access control (relaxed for testing)
    enforce_least_privilege: false
    require_approval_for_privileged_access: false
    enable_access_analyzer: true

    # Compliance (minimal)
    compliance_frameworks: []
    enable_compliance_monitoring: false
    audit_log_retention_days: 180  # 6 months

  # Backup and disaster recovery (moderate)
  backup:
    enabled: true
    retention_days: 14            # 2 weeks retention
    cross_region_backup: false
    point_in_time_recovery: true  # Needed for testing rollbacks
    automated_backup_window: "02:00-03:00"  # UTC
    backup_deletion_protection: false

  # Monitoring and alerting (enhanced for testing)
  monitoring:
    detailed_monitoring: true     # Detailed monitoring for performance testing
    custom_metrics: true
    alerting_enabled: true
    notification_channels:
      - email: "test-team@company.com"
      - slack: "#test-alerts"
      - pagerduty: false          # No pager duty for test env

    # Performance monitoring (enabled for performance testing)
    performance_insights: true
    x_ray_tracing: true

  # Cost optimization (moderate)
  cost_optimization:
    # Scheduled scaling for cost control
    auto_shutdown:
      enabled: true
      schedule: "business-hours-extended"  # Extended hours for testing
      weekend_shutdown: false     # Keep running on weekends for testing

    # Resource scheduling
    auto_scaling:
      enabled: true
      scale_in_protection: false
      min_capacity: 1             # Maintain minimum capacity

    # Lifecycle management
    s3_lifecycle_policies: true
    s3_intelligent_tiering: true
    ebs_snapshot_lifecycle: true
    log_lifecycle_management: true

  # Network configuration (production-like)
  networking:
    # Production-like networking for realistic testing
    dedicated_tenancy: false
    enhanced_networking: true
    placement_groups: false

    # DNS
    private_hosted_zones: true
    dns_resolution: true
    dns_hostnames: true

    # VPC configuration
    vpc:
      enable_nat_gateway: true
      single_nat_gateway: false   # Multi-AZ NAT for HA testing
      enable_vpn_gateway: false
      enable_dns_hostnames: true
      enable_dns_support: true

  # Compute configuration (balanced)
  compute:
    # EC2 settings (moderate sizing for testing)
    instance_types:
      preferred: ["t3.medium", "t3.large", "m5.large"]
      allowed: ["t3.*", "m5.*", "c5.large", "r5.large"]

    # EKS settings (production-like)
    kubernetes:
      version: "1.28"
      endpoint_private_access: true
      endpoint_public_access: true   # Allow external access for testing
      node_group_capacity_type: "ON_DEMAND"  # Stable capacity for testing
      node_group_instance_types: ["t3.large", "m5.large"]

  # Database configuration (production-like)
  database:
    # RDS settings
    multi_az: true                # Multi-AZ for HA testing
    backup_retention_period: 14
    backup_window: "02:00-03:00"  # UTC
    maintenance_window: "sun:03:00-sun:04:00"  # UTC
    deletion_protection: false    # Allow easy cleanup
    encryption_at_rest: true
    performance_insights_enabled: true  # Enable for performance testing
    monitoring_interval: 60       # Enhanced monitoring

    # Parameter group settings
    enhanced_monitoring: true
    log_exports: ["error", "general", "slow-query"]

  # Storage configuration (production-like)
  storage:
    # S3 settings
    versioning_enabled: true      # Enable versioning for testing
    mfa_delete: false
    lifecycle_configuration: true
    cross_region_replication: false
    access_logging: true

    # EBS settings
    encrypted: true
    volume_type: "gp3"
    iops: null
    throughput: null

# Test environment-specific component configurations
components:
  terraform:
    # Test environment deployment settings
    apply_auto_approve: false     # Still require approval for safety
    plan_timeout: 20              # Moderate timeout

    # State management
    state_lock_enabled: true
    state_encryption_enabled: true

    # Validation
    validate_required: true
    fmt_required: true

# Test environment tags
tags:
  Environment: "testenv-01"
  EnvironmentType: "testing"
  BusinessCritical: "false"
  TestEnvironment: "true"
  HighAvailability: "true"
  DisasterRecovery: "false"
  BackupRequired: "true"
  MonitoringLevel: "Enhanced"
  SecurityLevel: "Standard"
  ComplianceRequired: "false"
  PerformanceTesting: "true"
  LoadTesting: "true"
  TestDataEnabled: "true"