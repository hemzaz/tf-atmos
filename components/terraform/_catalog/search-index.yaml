# Alexandria Library - Search Index Configuration
# Version: 1.0.0
# Last Updated: 2025-12-02
#
# This file configures the search and discovery system for the Alexandria Library.
# It defines search indices, ranking algorithms, and recommendation logic.

version: "1.0.0"

# Search Index Configuration
indices:

  # Full-text search index
  # Searches across module names, descriptions, tags, and documentation
  - name: "full_text"
    enabled: true
    priority: 1

    fields:
      - field: "name"
        weight: 10.0
        analyzer: "standard"
        boost_exact_match: true

      - field: "description"
        weight: 5.0
        analyzer: "standard"

      - field: "long_description"
        weight: 3.0
        analyzer: "standard"

      - field: "tags"
        weight: 8.0
        analyzer: "keyword"
        boost_exact_match: true

      - field: "features"
        weight: 2.0
        analyzer: "standard"

      - field: "use_cases"
        weight: 4.0
        analyzer: "standard"

    configuration:
      min_score: 0.1
      max_results: 50
      fuzzy_matching: true
      fuzzy_distance: 2
      stemming: true
      stop_words: ["the", "a", "an", "and", "or", "but"]
      synonyms:
        - ["vpc", "virtual private cloud"]
        - ["eks", "kubernetes", "k8s"]
        - ["rds", "database", "db"]
        - ["ec2", "virtual machine", "vm", "instance"]
        - ["lambda", "function", "serverless"]
        - ["ha", "high availability", "highly available"]
        - ["dr", "disaster recovery"]
        - ["cicd", "ci/cd", "continuous integration"]

  # Category navigation index
  # Hierarchical browsing by category/subcategory
  - name: "category"
    enabled: true
    priority: 2

    fields:
      - field: "category"
        weight: 10.0
        analyzer: "keyword"

      - field: "subcategory"
        weight: 8.0
        analyzer: "keyword"

    hierarchy:
      - level: 1
        field: "category"
        display_name: "Category"

      - level: 2
        field: "subcategory"
        display_name: "Subcategory"

    sorting:
      default: "name"
      options:
        - "name"
        - "downloads"
        - "rating"
        - "last_updated"

  # Tag-based search index
  # Find modules by tags (features, capabilities)
  - name: "tags"
    enabled: true
    priority: 3

    fields:
      - field: "tags"
        weight: 10.0
        analyzer: "keyword"

    configuration:
      match_type: "any"  # Match any tag (OR) or all tags (AND)
      suggest_related_tags: true
      max_tag_suggestions: 10

  # Maturity level index
  # Filter by stability/production-readiness
  - name: "maturity"
    enabled: true
    priority: 4

    fields:
      - field: "maturity"
        weight: 10.0
        analyzer: "keyword"

    levels:
      - value: "experimental"
        display: "Experimental"
        color: "red"
        icon: "flask"
        description: "Early development, unstable"

      - value: "alpha"
        display: "Alpha"
        color: "orange"
        icon: "beaker"
        description: "Feature development, breaking changes likely"

      - value: "beta"
        display: "Beta"
        color: "yellow"
        icon: "test-tube"
        description: "Feature complete, API stabilizing"

      - value: "stable"
        display: "Stable"
        color: "green"
        icon: "check-circle"
        description: "Production ready"

      - value: "mature"
        display: "Mature"
        color: "blue"
        icon: "shield-check"
        description: "Battle-tested, optimized"

      - value: "deprecated"
        display: "Deprecated"
        color: "gray"
        icon: "archive"
        description: "Marked for removal"

    configuration:
      default_filter: ["beta", "stable", "mature"]
      show_deprecated: false

  # Cost estimation index
  # Search by estimated monthly cost
  - name: "cost"
    enabled: true
    priority: 5

    fields:
      - field: "cost.estimated_monthly_usd"
        weight: 10.0
        type: "numeric"

      - field: "cost.cost_category"
        weight: 8.0
        analyzer: "keyword"

    ranges:
      - category: "free"
        min: 0
        max: 0
        display: "Free"
        icon: "gift"

      - category: "low"
        min: 0.01
        max: 50
        display: "Low ($0-50/mo)"
        icon: "dollar-sign"

      - category: "medium"
        min: 50.01
        max: 200
        display: "Medium ($50-200/mo)"
        icon: "credit-card"

      - category: "high"
        min: 200.01
        max: 1000
        display: "High ($200-1000/mo)"
        icon: "coins"

      - category: "very-high"
        min: 1000.01
        max: null
        display: "Very High ($1000+/mo)"
        icon: "money-bill-wave"

    configuration:
      default_sort: "cost.estimated_monthly_usd"
      show_cost_breakdown: true
      show_cost_factors: true

  # Complexity level index
  # Filter by difficulty/expertise required
  - name: "complexity"
    enabled: true
    priority: 6

    fields:
      - field: "complexity"
        weight: 10.0
        analyzer: "keyword"

    levels:
      - value: "beginner"
        display: "Beginner"
        icon: "seedling"
        description: "Simple, minimal configuration"

      - value: "intermediate"
        display: "Intermediate"
        icon: "tree"
        description: "Moderate complexity"

      - value: "advanced"
        display: "Advanced"
        icon: "forest"
        description: "Complex, requires expertise"

    configuration:
      show_variable_count: true
      show_setup_time: true

  # Popularity/trending index
  # Sort by downloads, ratings, recent activity
  - name: "popularity"
    enabled: true
    priority: 7

    fields:
      - field: "metrics.downloads"
        weight: 3.0
        type: "numeric"

      - field: "metrics.rating"
        weight: 5.0
        type: "numeric"

      - field: "metrics.rating_count"
        weight: 2.0
        type: "numeric"

      - field: "metrics.active_deployments"
        weight: 4.0
        type: "numeric"

      - field: "metrics.last_updated"
        weight: 1.0
        type: "date"

    scoring:
      # Popularity score formula
      # score = (downloads * 0.3) + (rating * rating_count * 0.5) + (active_deployments * 0.4) + (recency_boost * 0.1)
      formula: "weighted_sum"
      weights:
        downloads: 0.3
        rating_weighted: 0.5  # rating * rating_count
        active_deployments: 0.4
        recency: 0.1

      recency_decay:
        enabled: true
        half_life_days: 90
        max_age_days: 365

    configuration:
      trending_window_days: 30
      min_deployments_for_trending: 10
      min_rating_count: 5

  # Dependencies/compatibility index
  # Find modules that work together
  - name: "compatibility"
    enabled: true
    priority: 8

    fields:
      - field: "compatible_with"
        weight: 10.0
        analyzer: "keyword"

      - field: "dependencies.required_modules"
        weight: 8.0
        analyzer: "keyword"

      - field: "incompatible_with"
        weight: -5.0
        analyzer: "keyword"

    configuration:
      show_dependency_graph: true
      suggest_compatible_modules: true
      max_suggestions: 5

  # Security/compliance index
  # Filter by security standards and compliance
  - name: "security"
    enabled: true
    priority: 9

    fields:
      - field: "security.compliance"
        weight: 10.0
        analyzer: "keyword"

      - field: "security.vulnerabilities.critical"
        weight: -10.0
        type: "numeric"

      - field: "security.vulnerabilities.high"
        weight: -5.0
        type: "numeric"

    compliance_standards:
      - "CIS AWS Foundations"
      - "HIPAA"
      - "PCI DSS"
      - "SOC 2"
      - "ISO 27001"
      - "NIST"
      - "FedRAMP"
      - "GDPR"

    configuration:
      only_secure: true
      max_vulnerabilities:
        critical: 0
        high: 0
        medium: 5

  # Performance index
  # Filter by deployment time, resource count, efficiency
  - name: "performance"
    enabled: true
    priority: 10

    fields:
      - field: "performance.deployment_time_seconds"
        weight: 5.0
        type: "numeric"

      - field: "performance.resource_count"
        weight: 3.0
        type: "numeric"

      - field: "performance.state_size_kb"
        weight: 2.0
        type: "numeric"

    thresholds:
      deployment_time:
        fast: 300      # < 5 minutes
        moderate: 900  # < 15 minutes
        slow: 1800     # < 30 minutes

      resource_count:
        small: 20
        medium: 100
        large: 500

    configuration:
      prefer_faster_deployment: true
      show_performance_metrics: true

# Ranking Algorithm
ranking:
  # Default ranking when no specific criteria provided
  default:
    algorithm: "bm25"  # Best Match 25 algorithm

    factors:
      - name: "relevance"
        weight: 0.4

      - name: "quality"
        weight: 0.3
        formula: "(rating * log(rating_count + 1))"

      - name: "popularity"
        weight: 0.2
        formula: "log(downloads + 1)"

      - name: "recency"
        weight: 0.1
        formula: "1 / (days_since_update + 1)"

  # Personalized ranking based on user context
  personalized:
    enabled: true

    factors:
      - name: "usage_history"
        weight: 0.3
        description: "Modules user has used before"

      - name: "team_usage"
        weight: 0.2
        description: "Modules team uses"

      - name: "similar_projects"
        weight: 0.2
        description: "Modules in similar projects"

      - name: "expertise_level"
        weight: 0.1
        description: "Match user's expertise"

      - name: "relevance"
        weight: 0.2
        description: "Query relevance"

# Recommendation Engine
recommendations:

  # Recommend modules based on current selection
  similar_modules:
    enabled: true

    algorithms:
      - name: "content_based"
        weight: 0.4
        features:
          - "tags"
          - "category"
          - "complexity"
          - "cost_category"

      - name: "collaborative_filtering"
        weight: 0.3
        method: "item_to_item"
        description: "Users who used X also used Y"

      - name: "graph_based"
        weight: 0.3
        method: "dependency_graph"
        description: "Modules that work well together"

    configuration:
      max_recommendations: 5
      min_similarity_score: 0.6
      diversify_results: true

  # Recommend complementary modules
  complementary_modules:
    enabled: true

    rules:
      - when: "vpc-*"
        recommend:
          - "securitygroup"
          - "dns"
          - "monitoring"
        reason: "Essential VPC companions"

      - when: "eks-*"
        recommend:
          - "eks-addons"
          - "external-secrets"
          - "monitoring"
        reason: "EKS essentials"

      - when: "rds-*"
        recommend:
          - "backup"
          - "monitoring"
          - "secretsmanager"
        reason: "Database best practices"

      - when: "lambda"
        recommend:
          - "apigateway"
          - "monitoring"
          - "iam"
        reason: "Serverless stack"

    configuration:
      max_recommendations: 3
      show_reason: true

  # Recommend patterns/blueprints
  pattern_recommendations:
    enabled: true

    triggers:
      - when_selecting: ["vpc-*", "eks-*", "rds-*"]
        recommend: "microservices-platform"
        confidence: 0.8

      - when_selecting: ["vpc-*", "ec2", "rds-*", "apigateway"]
        recommend: "web-app-ecs"
        confidence: 0.9

      - when_selecting: ["lambda", "apigateway", "dynamodb"]
        recommend: "web-app-serverless"
        confidence: 0.85

    configuration:
      min_confidence: 0.7
      show_pattern_diagram: true

# Faceted Search
facets:

  - name: "category"
    display: "Category"
    type: "hierarchy"
    multi_select: false

  - name: "maturity"
    display: "Maturity"
    type: "checkbox"
    multi_select: true
    default: ["stable", "mature"]

  - name: "tags"
    display: "Tags"
    type: "checkbox"
    multi_select: true
    max_display: 15

  - name: "complexity"
    display: "Complexity"
    type: "radio"
    multi_select: false

  - name: "cost_category"
    display: "Cost"
    type: "checkbox"
    multi_select: true

  - name: "compliance"
    display: "Compliance"
    type: "checkbox"
    multi_select: true
    source: "security.compliance"

# Auto-completion
autocomplete:
  enabled: true

  sources:
    - field: "name"
      weight: 10

    - field: "tags"
      weight: 8

    - field: "category"
      weight: 5

  configuration:
    min_characters: 2
    max_suggestions: 10
    fuzzy_matching: true
    highlight_match: true
    show_category: true
    show_icon: true

# Query Suggestions
suggestions:
  enabled: true

  # Suggest corrections for typos
  spell_check:
    enabled: true
    max_distance: 2
    suggest_on_no_results: true

  # Suggest better queries
  query_rewriting:
    enabled: true

    rules:
      - pattern: "k8s"
        rewrite: "eks OR kubernetes"

      - pattern: "db"
        rewrite: "rds OR database"

      - pattern: "vm"
        rewrite: "ec2 OR virtual machine"

      - pattern: "container"
        rewrite: "eks OR ecs OR docker"

  # Suggest related searches
  related_searches:
    enabled: true
    max_suggestions: 5

    rules:
      - when: "vpc"
        suggest:
          - "vpc with eks"
          - "vpc best practices"
          - "vpc multi-az"

      - when: "eks"
        suggest:
          - "eks production setup"
          - "eks with monitoring"
          - "eks autoscaling"

# Search Analytics
analytics:
  enabled: true

  track:
    - "search_queries"
    - "search_results_clicked"
    - "zero_result_searches"
    - "facet_usage"
    - "popular_searches"
    - "conversion_rate"  # search -> deployment

  reports:
    - name: "popular_searches"
      interval: "daily"

    - name: "zero_results"
      interval: "daily"
      alert_threshold: 10

    - name: "search_performance"
      interval: "hourly"
      metrics: ["latency", "result_count"]

# Cache Configuration
cache:
  enabled: true

  # Cache search results
  search_results:
    ttl_seconds: 300
    max_size_mb: 100

  # Cache index
  index:
    ttl_seconds: 3600
    max_size_mb: 500

  # Cache recommendations
  recommendations:
    ttl_seconds: 1800
    max_size_mb: 50

# Performance Tuning
performance:

  # Query timeout
  timeout_ms: 5000

  # Maximum results per page
  max_results_per_page: 50
  default_results_per_page: 20

  # Index refresh interval
  index_refresh_seconds: 60

  # Concurrent queries
  max_concurrent_queries: 100

# API Configuration
api:

  # RESTful search endpoint
  endpoint: "/api/v1/search"

  # Rate limiting
  rate_limit:
    requests_per_minute: 100
    burst: 20

  # Response format
  response:
    format: "json"
    include_metadata: true
    include_facets: true
    include_suggestions: true

# CLI Configuration
cli:

  # Command: alexandria search
  search_command:
    default_output: "table"
    output_formats: ["table", "json", "yaml"]
    color: true
    paging: true

  # Command: alexandria browse
  browse_command:
    interactive: true
    show_tree: true

  # Command: alexandria recommend
  recommend_command:
    max_results: 5
    show_reason: true

---

# Example Queries

# Simple text search
# alexandria search "vpc"

# Category filter
# alexandria search --category "compute/containers"

# Multiple filters
# alexandria search --tags "serverless,api" --maturity stable --cost-max 100

# Complexity filter
# alexandria search "database" --complexity beginner

# Compliance filter
# alexandria search --compliance "HIPAA,PCI DSS"

# Cost range
# alexandria search --cost-min 0 --cost-max 50

# Trending modules
# alexandria search --sort trending --timeframe 30d

# By popularity
# alexandria search --sort popular

# Compatible with
# alexandria search --compatible-with "vpc-standard"
