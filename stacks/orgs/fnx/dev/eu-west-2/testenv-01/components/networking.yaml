---
# Networking component configurations for testenv-01 environment
# Defines VPC and network resources

import:
  # Import hierarchy - no .yaml extensions
  - orgs/fnx/dev/eu-west-2/testenv-01/components/globals
  - catalog/vpc/defaults
  - catalog/network/defaults

components:
  terraform:
    # VPC instances
    vpc/main:
      metadata:
        component: vpc
        inherits:
          - vpc/defaults
      vars:
        name: main
        # FIXED: Use consistent variable name matching the component
        vpc_cidr: "10.0.0.0/16"
        vpc_flow_logs_enabled: "${enable_vpc_flow_logs}"
        # Subnet configuration
        private_subnets:
          - "10.0.1.0/24"
          - "10.0.2.0/24"
          - "10.0.3.0/24"
        public_subnets:
          - "10.0.101.0/24"
          - "10.0.102.0/24"
          - "10.0.103.0/24"

    vpc/services:
      metadata:
        component: vpc
        inherits:
          - vpc/defaults
      vars:
        name: services
        # FIXED: Use consistent variable name matching the component
        vpc_cidr: "10.1.0.0/16"
        vpc_flow_logs_enabled: "${enable_vpc_flow_logs}"
        map_public_ip_on_launch: false
        # Subnet configuration
        private_subnets:
          - "10.1.1.0/24"
          - "10.1.2.0/24"
          - "10.1.3.0/24"
        public_subnets:
          - "10.1.101.0/24"
          - "10.1.102.0/24"
          - "10.1.103.0/24"

    # Network resources for main VPC
    network/main:
      metadata:
        component: network
      vars:
        vpc_id: "${output.vpc/main.vpc_id}"
        # DNS settings
        dns_create_root_zone: false
        dns_multi_account: false

        # Define zones
        dns_zones:
          main:
            name: "fnx.example.com"
            comment: "Main zone for fnx environment"
            force_destroy: true
            enable_query_logging: true
            vpc_associations: []
          internal:
            name: "internal.fnx.example.com"
            comment: "Internal DNS for fnx environment"
            force_destroy: true

        # Define essential DNS records
        dns_records:
          www_main:
            zone_name: "main"
            name: "www.fnx.example.com"
            type: "A"
            ttl: 300
            records: ["10.0.101.100"]
          db_internal:
            zone_name: "internal"
            name: "db.internal.fnx.example.com"
            type: "A"
            ttl: 60
            records: ["10.0.1.50"]

    # Network resources for services VPC
    network/services:
      metadata:
        component: network
      vars:
        vpc_id: "${output.vpc/services.vpc_id}"
        # DNS settings
        dns_create_root_zone: false
        dns_multi_account: false

        # Define zones
        dns_zones:
          services:
            name: "services.fnx.example.com"
            comment: "Services zone for fnx environment"
            force_destroy: true
          data:
            name: "data.services.fnx.example.com"
            comment: "Data services DNS zone"
            force_destroy: true

        # Define essential DNS records
        dns_records:
          api_services:
            zone_name: "services"
            name: "api.services.fnx.example.com"
            type: "CNAME"
            ttl: 300
            records: ["api-internal.services.fnx.example.com"]
